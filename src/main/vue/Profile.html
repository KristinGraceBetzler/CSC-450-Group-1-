<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="stylesheet" href="Profile.css">
</head>
<body>

    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Profile Settings</h2>
            <form action="Profile.html" class="settingsForm">
                <table class="settingsTable">
                    <tr>
                        <td> <h3>Username</h3> </td>
                        <td> <input type="text" class="input" value="TestUsrNme" id="settingsUser"> </td>
                    </tr>
                    <tr>
                        <td> <h3>Email</h3> </td>
                        <td> <input type="email" class="input" value="123@test.com" id="settingsEmail"> </td>
                    </tr>
                    <tr>
                        <td> <h3>Country of travel</h3> </td>
                        <td> <select name="country" id="country"> <option value="USA">USA</option> </select> </td>
                    </tr>
                    <tr>
                        <td> <h3>Preferred Flight Carrier</h3> </td>
                        <td>
                            <select name="carrier" id="carrier">
                                <option value="alaska">Alaska</option>
                                <option value="american">American</option>
                                <option value="delta">Delta</option>
                                <option value= "frontier">Frontier</option>
                                <option value="jetBlue">Jet Blue</option>
                                <option value="southwest">Southwest</option>
                                <option value="spirit">Spirit (ew)</option>
                                <option value="sunCountry">Sun Country</option>
                                <option value="united">United</option>
                        </td>
                    </tr>
                </table>
                <input type="submit" id="submit" value="Save Settings">
            </form>

        </div>
    </div>

    <div class="Header">
        <button id="Main" onclick="location.href='Main.html'">Main</button>
        <button id="Logout" onclick="location.href='index.html'">Logout</button>
    </div>
    <div class="UserInfo">
        <table id="UserData">
            <tr>
                <td>
                    <p>{{ username }}</p>
                    <p>{{ email }}</p>
                    <p>{{preference_1}}</p>
                    <p>{{preference_2}}</p>
                </td>
                <td id="Settings"> <!-- Buttons may change depending on need -->
                    <button id="settings">Settings</button> <br> <!-- Onclick: popup form allowing user to update info -->
                    <button onclick="location.href='Swipe.html'">Take a Trip!</button> <br> <!-- Need Quiz intro page before starting quiz -->
                </td>
        </table>
    </div>

    <div class="Divider">
        <hr>
    </div>

    <div class="Trip" id="UserTrips">
        <table id="TripData"> <!-- TripData will be repeated on page as many times as requried, depending on how many trips user has booked -->
            <tr>
                <td><h1>Loading...</h1></td>
            </tr>
        </table>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    </script>

    <script>

        const userInfo = JSON.parse(localStorage.getItem('userInfo'))

        const UserData = Vue.createApp({
            data() {
                return {
                    username: userInfo.userName,
                    email: userInfo.email,
                    preference_1: "USA",
                    preference_2: "Delta"
                }
            }
        })

        UserData.mount('#UserData')

        // Get the modal
        var modal = document.getElementById("modal")

        // Get the button that opens the modal
        var btn = document.getElementById("settings")

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks the button, open the modal
        btn.onclick = function() {
            modal.style.display = "block"
            var userName = document.getElementById("settingsUser");
            var email = document.getElementById("settingsEmail");
            userName.value = userInfo.userName;
            email.value = userInfo.email;
        }

        // When the user click on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        function displayTrips() {
            fetch("https://wefliapp-v1-3.onrender.com/user/userTrips", {
            method: "POST",
            body: JSON.stringify(parseInt(userInfo.userID)),
            headers: {'Content-Type' : 'application/json'}
        }).then(res => res.json())
        .then(data => {
            const testTable = document.getElementById("TripData");
            testTable.remove();
            if (Object.keys(data).length != 0) {
                for (let i = 0; i < Object.keys(data).length; i++) {
                    // create a table
                    var table = document.createElement("TABLE");
                    // create a table row
                    const row = table.insertRow();

                    // create the image cell
                    const image = row.insertCell();
                    // create and insert a picture into the image cell
                    img = document.createElement("img");
                    img.src = "images/CityMap.png";
                    image.appendChild(img);

                    // create the next cell for other trip info
                    const otherData = row.insertCell();

                    // create location header
                    const head1 = document.createElement("h1");
                    const head1Info = document.createTextNode(data[i].destination.destinationCity + ", " + data[i].destination.destinationState);
                    head1.appendChild(head1Info);
                    otherData.appendChild(head1);
                    otherData.appendChild(document.createElement("br"));

                    // create line breaks
                    otherData.appendChild(document.createElement("br"));

                    // create activities header and add line break
                    const activityHead = document.createElement("h3");
                    const actHeadInfo = document.createTextNode("Activities to do:");
                    activityHead.appendChild(actHeadInfo);
                    otherData.appendChild(activityHead); otherData.appendChild(document.createElement("br"));

                    // create the activities
                    for (let j = 0; j < 3; j++) {
                        const activity = document.createElement("p");
                        const activityInfo = document.createTextNode(j+1 + ": " + data[i].tripsExcursions[j].excursionTitle);
                        activity.appendChild(activityInfo);
                        otherData.appendChild(activity);
                    }
                    
                    const container = document.getElementById("UserTrips");
                    container.appendChild(table);
                }
            } else {
                var table = document.createElement("TABLE");
                // create a table row
                const row = table.insertRow();

                const cell = row.insertCell();
                
                const head = document.createElement("h1");
                const headText = document.createTextNode("No trips to display! Go create a trip!");
                head.appendChild(headText);
                cell.appendChild(head);

                const container = document.getElementById("UserTrips");
                container.appendChild(table);
            }
        });
        }

        window.addEventListener('load', function() {
            displayTrips()
        });
    </script>

    <script>

    </script>
</body>
</html>
